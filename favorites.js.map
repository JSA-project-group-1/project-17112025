{"version":3,"file":"favorites.js","sources":["../src/js/main-favorites.js"],"sourcesContent":["import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\n\n\nimport '/css/pages/favorites.css';\n\n\nconst FAVORITES_KEY = \"favorite_workouts\";\nconst ITEMS_PER_PAGE = 12;\n\nlet favoritesState = [];\nlet currentPage = 1;\n\n// ====== СЕРВІС ДЛЯ localStorage ======\n\nfunction readFavoritesFromStorage() {\n  const raw = localStorage.getItem(FAVORITES_KEY);\n  if (!raw) return [];\n\n  try {\n    const parsed = JSON.parse(raw);\n    return Array.isArray(parsed) ? parsed : [];\n  } catch (err) {\n    console.error(\"Failed to parse favorites from LS:\", err);\n    iziToast.error({\n      message: \"Favorites data is corrupted. Clearing storage.\",\n      position: \"topRight\",\n      maxWidth: 600,\n    });\n    localStorage.removeItem(FAVORITES_KEY);\n    return [];\n  }\n}\n\nfunction saveFavoritesToStorage(favorites) {\n  localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));\n}\n\n// ====== API ======\n\n// Тягнемо ВЕСЬ список вправ з першої сторінки\nasync function fetchAllWorkouts() {\n  const url =\n    \"https://your-energy.b.goit.study/api/exercises?page=1&limit=100\";\n\n  const response = await fetch(url);\n  if (!response.ok) {\n    throw new Error(`HTTP error: ${response.status}`);\n  }\n\n  const data = await response.json();\n\n  if (Array.isArray(data)) return data;\n  if (Array.isArray(data.results)) return data.results;\n  if (Array.isArray(data.data)) return data.data;\n\n  throw new Error(\"Unexpected API response format\");\n}\n\n// ====== РЕНДЕР ======\n\nfunction getFavoritesContainer() {\n  let container = document.querySelector(\"[data-favorites-list]\");\n\n  if (!container) {\n    container = document.getElementById(\"favorites-list\");\n  }\n\n  if (!container) {\n    const controls =\n      document.querySelector(\".favorites-test-controls\") ||\n      document.querySelector(\"section .container\");\n\n    if (!controls) return null;\n\n    container = document.createElement(\"div\");\n    container.id = \"favorites-list\";\n    container.classList.add(\"favorites-list\");\n    controls.insertAdjacentElement(\"afterend\", container);\n  }\n\n  return container;\n}\n\nfunction createWorkoutCardMarkup(workout) {\n  const {\n    _id,\n    name,\n    burnedCalories,\n    time,\n    bodyPart,\n    target,\n  } = workout;\n\n  return `\n    <article class=\"favorite-card\" data-id=\"${_id}\">\n      <div class=\"favorite-card-header\">\n        <span class=\"favorite-card-label\">WORKOUT</span>\n        <button\n          type=\"button\"\n          class=\"favorite-remove-btn\"\n        >\n          Remove card\n        </button>\n      </div>\n\n      <h3 class=\"favorite-card-title\">${name}</h3>\n\n      <p class=\"favorite-card-text\">\n        Burned calories: <span>${burnedCalories} / ${time} min</span>\n      </p>\n      <p class=\"favorite-card-text\">\n        Body part: <span>${bodyPart}</span>\n      </p>\n      <p class=\"favorite-card-text\">\n        Target: <span>${target}</span>\n      </p>\n    </article>\n  `;\n}\n\nfunction createPaginationMarkup(totalPages, page) {\n  if (totalPages <= 1) return \"\";\n\n  const prevDisabled = page === 1 ? \"disabled\" : \"\";\n  const nextDisabled = page === totalPages ? \"disabled\" : \"\";\n\n  return `\n    <div class=\"favorites-pagination\">\n      <button\n        type=\"button\"\n        class=\"favorites-page-btn\"\n        data-page=\"prev\"\n        ${prevDisabled}\n      >&lt;</button>\n\n      <span class=\"favorites-page-info\">${page} / ${totalPages}</span>\n\n      <button\n        type=\"button\"\n        class=\"favorites-page-btn\"\n        data-page=\"next\"\n        ${nextDisabled}\n      >&gt;</button>\n    </div>\n  `;\n}\n\nfunction renderFavoritesList() {\n  const container = getFavoritesContainer();\n  if (!container) return;\n\n  if (!favoritesState.length) {\n    container.innerHTML = \"<p>No favorite workouts yet.</p>\";\n\n    const oldPagination = document.querySelector(\".favorites-pagination\");\n    if (oldPagination) oldPagination.remove();\n\n    return;\n  }\n\n  const totalPages = Math.max(\n    1,\n    Math.ceil(favoritesState.length / ITEMS_PER_PAGE)\n  );\n\n  if (currentPage > totalPages) {\n    currentPage = totalPages;\n  }\n\n  const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;\n  const endIndex = startIndex + ITEMS_PER_PAGE;\n  const itemsForPage = favoritesState.slice(startIndex, endIndex);\n\n  const cardsMarkup = itemsForPage\n    .map(createWorkoutCardMarkup)\n    .join(\"\");\n\n  const paginationMarkup = createPaginationMarkup(totalPages, currentPage);\n\n  container.innerHTML = cardsMarkup;\n\n  const oldPagination = document.querySelector(\".favorites-pagination\");\n  if (oldPagination) oldPagination.remove();\n\n  container.insertAdjacentHTML(\"afterend\", paginationMarkup);\n}\n\n// ====== ЛОГІКА ДОДАВАННЯ ======\n\nasync function onAddBtnClick() {\n  try {\n    const workouts = await fetchAllWorkouts();\n\n    favoritesState = readFavoritesFromStorage();\n    const favoriteIds = new Set(favoritesState.map(w => w._id));\n\n    const nextWorkout = workouts.find(w => !favoriteIds.has(w._id));\n\n    if (!nextWorkout) {\n      iziToast.info({\n        title: \"No more workouts\",\n        message: \"All workouts from API are already in favorites.\",\n        position: \"topRight\",\n        maxWidth: 600,\n      });\n      console.log(\"All workouts from API are already in favorites.\");\n      return;\n    }\n\n    favoritesState.push(nextWorkout);\n    saveFavoritesToStorage(favoritesState);\n\n    const totalPages = Math.max(\n      1,\n      Math.ceil(favoritesState.length / ITEMS_PER_PAGE)\n    );\n    currentPage = totalPages;\n\n    renderFavoritesList();\n\n    iziToast.success({\n      title: nextWorkout.name,\n      message: \"Workout added to favorites.\",\n      position: \"topRight\",\n      maxWidth: 600,\n    });\n\n    console.log(\"Added workout:\", nextWorkout);\n    console.log(\"Favorites after add:\", favoritesState);\n  } catch (err) {\n    console.error(\"Failed to add favorite:\", err);\n    iziToast.error({\n      title: \"Error\",\n      message: \"Failed to add workout to favorites.\",\n      position: \"topRight\",\n      maxWidth: 600,\n    });\n  }\n}\n\n// ====== ЛОГІКА ВИДАЛЕННЯ + ПАГІНАЦІЯ ======\n\nfunction onFavoritesListClick(event) {\n  const removeBtn = event.target.closest(\".favorite-remove-btn\");\n  if (removeBtn) {\n    const card = removeBtn.closest(\".favorite-card\");\n    if (!card) return;\n\n    const workoutId = card.dataset.id;\n    if (!workoutId) return;\n\n    const removed = favoritesState.find(item => item._id === workoutId);\n    const newFavorites = favoritesState.filter(\n      item => item._id !== workoutId\n    );\n\n    if (newFavorites.length === favoritesState.length) {\n      return;\n    }\n\n    favoritesState = newFavorites;\n    saveFavoritesToStorage(favoritesState);\n\n    if (!favoritesState.length) {\n      currentPage = 1;\n      renderFavoritesList();\n    } else {\n      const totalPages = Math.max(\n        1,\n        Math.ceil(favoritesState.length / ITEMS_PER_PAGE)\n      );\n      if (currentPage > totalPages) currentPage = totalPages;\n      renderFavoritesList();\n    }\n\n    iziToast.success({\n      title: removed ? removed.name : \"Workout\",\n      message: \"Workout removed from favorites.\",\n      position: \"topRight\",\n      maxWidth: 600,\n    });\n\n    console.log(\"Removed id:\", workoutId);\n    console.log(\"Favorites after remove:\", favoritesState);\n    return;\n  }\n\n  const pageBtn = event.target.closest(\".favorites-page-btn\");\n  if (pageBtn) {\n    const action = pageBtn.dataset.page;\n    const totalPages = Math.max(\n      1,\n      Math.ceil(favoritesState.length / ITEMS_PER_PAGE)\n    );\n\n    if (action === \"prev\" && currentPage > 1) {\n      currentPage -= 1;\n    } else if (action === \"next\" && currentPage < totalPages) {\n      currentPage += 1;\n    }\n\n    renderFavoritesList();\n  }\n}\n\n// ====== ІНІЦІАЛІЗАЦІЯ СТОРІНКИ ======\n\nfunction initFavoritesPage() {\n  const addBtn = document.getElementById(\"favorites-add-btn\");\n\n  if (addBtn) {\n    addBtn.addEventListener(\"click\", onAddBtnClick);\n  }\n\n  // слухаємо кліки по всьому документу:\n  document.addEventListener(\"click\", onFavoritesListClick);\n\n  favoritesState = readFavoritesFromStorage();\n  currentPage = 1;\n  renderFavoritesList();\n\n  console.log(\"Favorites page initialized. Current favorites:\", favoritesState);\n}\n\ninitFavoritesPage();"],"names":["FAVORITES_KEY","ITEMS_PER_PAGE","favoritesState","currentPage","readFavoritesFromStorage","raw","parsed","err","iziToast","saveFavoritesToStorage","favorites","fetchAllWorkouts","response","data","getFavoritesContainer","container","controls","createWorkoutCardMarkup","workout","_id","name","burnedCalories","time","bodyPart","target","createPaginationMarkup","totalPages","page","renderFavoritesList","oldPagination","startIndex","endIndex","cardsMarkup","paginationMarkup","onAddBtnClick","workouts","favoriteIds","w","nextWorkout","onFavoritesListClick","event","removeBtn","card","workoutId","removed","item","newFavorites","pageBtn","action","initFavoritesPage","addBtn"],"mappings":"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"}