{"version":3,"file":"favorites.js","sources":["../src/js/main-favorites.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport '/css/pages/favorites.css';\nimport '/css/pages/modal-exercise.css';\nimport '/css/pages/section-exercises.css';\nimport './header.js';\nimport './modal-exercise.js';\nimport { renderQuoteOfTheDay } from './render-functions.js';\n\nconst FAVORITES_KEY = 'favorite_workouts';\nconst ITEMS_PER_PAGE = 12;\n\nlet favoritesState = [];\nlet currentPage = 1;\n\n// ====== СЕРВІС ДЛЯ localStorage ======\n\nfunction readFavoritesFromStorage() {\n  const raw = localStorage.getItem(FAVORITES_KEY);\n  if (!raw) return [];\n\n  try {\n    const parsed = JSON.parse(raw);\n    return Array.isArray(parsed) ? parsed : [];\n  } catch (err) {\n    console.error('Failed to parse favorites from LS:', err);\n    iziToast.error({\n      message: 'Favorites data is corrupted. Clearing storage.',\n      position: 'topRight',\n      maxWidth: 600,\n    });\n    localStorage.removeItem(FAVORITES_KEY);\n    return [];\n  }\n}\n\nfunction saveFavoritesToStorage(favorites) {\n  localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));\n}\n\n// ====== РЕНДЕР ======\n\nfunction getFavoritesContainer() {\n  let container = document.querySelector('[data-favorites-list]');\n\n  if (!container) {\n    container = document.getElementById('favorites-list');\n  }\n\n  if (!container) {\n    const parent = document.querySelector('section .container');\n    if (!parent) return null;\n\n    container = document.createElement('div');\n    container.id = 'favorites-list';\n    container.classList.add('favorites-list', 'exercises-list');\n    parent.appendChild(container);\n  } else {\n    container.classList.add('favorites-list', 'exercises-list');\n  }\n\n  return container;\n}\n\nfunction createWorkoutCardMarkup(workout) {\n  const { _id, name, burnedCalories, time, bodyPart, target } = workout;\n\n  return `\n    <li class=\"exercises-item favorite-card favorites-item\" data-id=\"${_id}\">\n      <div class=\"header\">\n        <div class=\"workout-rating\">\n          <span class=\"type\">WORKOUT</span>\n          <button\n            type=\"button\"\n            class=\"favorite-remove-btn\"\n          >\n            Remove\n          </button>\n        </div>\n\n        <button\n          class=\"start-btn\"\n          type=\"button\"\n          data-modal-exercise=\"open\"\n          data-exercise-id=\"${_id}\"\n        >\n          Start\n        </button>\n      </div>\n\n      <div class=\"title\">\n        <span class=\"icon\"></span>${name}\n      </div>\n\n      <div class=\"details\">\n        <ul class=\"exercise-details-list\">\n          <li class=\"calories\">\n            <span class=\"calories-name\">Burned calories</span>\n            <span class=\"calories-value\">${burnedCalories} / ${time} min</span>\n          </li>\n          <li class=\"body-part\">\n            <span class=\"body-part-name\">Body part:</span>\n            <span class=\"body-part-value\">${bodyPart}</span>\n          </li>\n          <li class=\"target\">\n            <span class=\"target-name\">Target:</span>\n            <span class=\"target-value\">${target}</span>\n          </li>\n        </ul>\n      </div>\n    </li>\n  `;\n}\n\nfunction createPaginationMarkup(totalPages, page) {\n  if (totalPages <= 1) return '';\n\n  const prevDisabled = page === 1 ? 'disabled' : '';\n  const nextDisabled = page === totalPages ? 'disabled' : '';\n\n  return `\n    <div class=\"favorites-pagination\">\n      <button\n        type=\"button\"\n        class=\"favorites-page-btn\"\n        data-page=\"prev\"\n        ${prevDisabled}\n      >&lt;</button>\n\n      <span class=\"favorites-page-info\">${page} / ${totalPages}</span>\n\n      <button\n        type=\"button\"\n        class=\"favorites-page-btn\"\n        data-page=\"next\"\n        ${nextDisabled}\n      >&gt;</button>\n    </div>\n  `;\n}\n\nfunction renderFavoritesList() {\n  const container = getFavoritesContainer();\n  if (!container) return;\n\n  if (!favoritesState.length) {\n    container.innerHTML = '<p>No favorite workouts yet.</p>';\n\n    const oldPagination = document.querySelector('.favorites-pagination');\n    if (oldPagination) oldPagination.remove();\n\n    return;\n  }\n\n  const totalPages = Math.max(\n    1,\n    Math.ceil(favoritesState.length / ITEMS_PER_PAGE)\n  );\n\n  if (currentPage > totalPages) {\n    currentPage = totalPages;\n  }\n\n  const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;\n  const endIndex = startIndex + ITEMS_PER_PAGE;\n  const itemsForPage = favoritesState.slice(startIndex, endIndex);\n\n  const cardsMarkup = itemsForPage.map(createWorkoutCardMarkup).join('');\n  const paginationMarkup = createPaginationMarkup(totalPages, currentPage);\n\n  container.innerHTML = cardsMarkup;\n\n  const oldPagination = document.querySelector('.favorites-pagination');\n  if (oldPagination) oldPagination.remove();\n\n  container.insertAdjacentHTML('afterend', paginationMarkup);\n}\n\n// ====== СИНХРОНІЗАЦІЯ ПІСЛЯ ЗАКРИТТЯ МОДАЛКИ ======\n\nfunction syncFavoritesFromStorageIfChanged() {\n  const newState = readFavoritesFromStorage();\n\n  const prev = JSON.stringify(favoritesState);\n  const next = JSON.stringify(newState);\n\n  if (prev === next) return;\n\n  favoritesState = newState;\n\n  if (!favoritesState.length) {\n    currentPage = 1;\n  } else {\n    const totalPages = Math.max(\n      1,\n      Math.ceil(favoritesState.length / ITEMS_PER_PAGE)\n    );\n    if (currentPage > totalPages) currentPage = totalPages;\n  }\n\n  renderFavoritesList();\n}\n\n// ====== ВИДАЛЕННЯ + ПАГІНАЦІЯ + ЗАКРИТТЯ МОДАЛКИ ======\n\nfunction onFavoritesListClick(event) {\n  const closeModalBtn = event.target.closest('[data-modal-exercise=\"close\"]');\n  if (closeModalBtn) {\n    syncFavoritesFromStorageIfChanged();\n    return;\n  }\n\n  const removeBtn = event.target.closest('.favorite-remove-btn');\n  if (removeBtn) {\n    const card = removeBtn.closest('.favorite-card');\n    if (!card) return;\n\n    const workoutId = card.dataset.id;\n    if (!workoutId) return;\n\n    const removed = favoritesState.find(item => item._id === workoutId);\n    const newFavorites = favoritesState.filter(item => item._id !== workoutId);\n\n    if (newFavorites.length === favoritesState.length) {\n      return;\n    }\n\n    favoritesState = newFavorites;\n    saveFavoritesToStorage(favoritesState);\n\n    if (!favoritesState.length) {\n      currentPage = 1;\n    } else {\n      const totalPages = Math.max(\n        1,\n        Math.ceil(favoritesState.length / ITEMS_PER_PAGE)\n      );\n      if (currentPage > totalPages) currentPage = totalPages;\n    }\n\n    renderFavoritesList();\n\n    iziToast.success({\n      title: removed ? removed.name : 'Workout',\n      message: 'Workout removed from favorites.',\n      position: 'topRight',\n      maxWidth: 600,\n    });\n\n    return;\n  }\n\n  const pageBtn = event.target.closest('.favorites-page-btn');\n  if (pageBtn) {\n    const action = pageBtn.dataset.page;\n    const totalPages = Math.max(\n      1,\n      Math.ceil(favoritesState.length / ITEMS_PER_PAGE)\n    );\n\n    if (action === 'prev' && currentPage > 1) {\n      currentPage -= 1;\n    } else if (action === 'next' && currentPage < totalPages) {\n      currentPage += 1;\n    }\n\n    renderFavoritesList();\n  }\n}\n\n// ====== INIT ======\n\nfunction initFavoritesPage() {\n  document.addEventListener('click', onFavoritesListClick);\n\n  favoritesState = readFavoritesFromStorage();\n  currentPage = 1;\n\n  renderQuoteOfTheDay();\n\n  renderFavoritesList();\n}\n\ninitFavoritesPage();\n"],"names":["FAVORITES_KEY","ITEMS_PER_PAGE","favoritesState","currentPage","readFavoritesFromStorage","raw","parsed","err","iziToast","saveFavoritesToStorage","favorites","getFavoritesContainer","container","parent","createWorkoutCardMarkup","workout","_id","name","burnedCalories","time","bodyPart","target","createPaginationMarkup","totalPages","page","renderFavoritesList","oldPagination","startIndex","endIndex","cardsMarkup","paginationMarkup","syncFavoritesFromStorageIfChanged","newState","prev","next","onFavoritesListClick","event","removeBtn","card","workoutId","removed","item","newFavorites","pageBtn","action","initFavoritesPage","renderQuoteOfTheDay"],"mappings":"0GAUA,MAAMA,EAAgB,oBAChBC,EAAiB,GAEvB,IAAIC,EAAiB,CAAA,EACjBC,EAAc,EAIlB,SAASC,GAA2B,CAClC,MAAMC,EAAM,aAAa,QAAQL,CAAa,EAC9C,GAAI,CAACK,EAAK,MAAO,CAAA,EAEjB,GAAI,CACF,MAAMC,EAAS,KAAK,MAAMD,CAAG,EAC7B,OAAO,MAAM,QAAQC,CAAM,EAAIA,EAAS,CAAA,CAC1C,OAASC,EAAK,CACZ,eAAQ,MAAM,qCAAsCA,CAAG,EACvDC,EAAS,MAAM,CACb,QAAS,iDACT,SAAU,WACV,SAAU,GAChB,CAAK,EACD,aAAa,WAAWR,CAAa,EAC9B,CAAA,CACT,CACF,CAEA,SAASS,EAAuBC,EAAW,CACzC,aAAa,QAAQV,EAAe,KAAK,UAAUU,CAAS,CAAC,CAC/D,CAIA,SAASC,GAAwB,CAC/B,IAAIC,EAAY,SAAS,cAAc,uBAAuB,EAM9D,GAJKA,IACHA,EAAY,SAAS,eAAe,gBAAgB,GAGjDA,EASHA,EAAU,UAAU,IAAI,iBAAkB,gBAAgB,MAT5C,CACd,MAAMC,EAAS,SAAS,cAAc,oBAAoB,EAC1D,GAAI,CAACA,EAAQ,OAAO,KAEpBD,EAAY,SAAS,cAAc,KAAK,EACxCA,EAAU,GAAK,iBACfA,EAAU,UAAU,IAAI,iBAAkB,gBAAgB,EAC1DC,EAAO,YAAYD,CAAS,CAC9B,CAIA,OAAOA,CACT,CAEA,SAASE,EAAwBC,EAAS,CACxC,KAAM,CAAE,IAAAC,EAAK,KAAAC,EAAM,eAAAC,EAAgB,KAAAC,EAAM,SAAAC,EAAU,OAAAC,CAAM,EAAKN,EAE9D,MAAO;AAAA,uEAC8DC,CAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAgB5CA,CAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCAOGC,CAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CAOGC,CAAc,MAAMC,CAAI;AAAA;AAAA;AAAA;AAAA,4CAIvBC,CAAQ;AAAA;AAAA;AAAA;AAAA,yCAIXC,CAAM;AAAA;AAAA;AAAA;AAAA;AAAA,GAM/C,CAEA,SAASC,EAAuBC,EAAYC,EAAM,CAChD,OAAID,GAAc,EAAU,GAKrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAHcC,IAAS,EAAI,WAAa,EAS3B;AAAA;AAAA;AAAA,0CAGoBA,CAAI,MAAMD,CAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAXvCC,IAASD,EAAa,WAAa,EAiBpC;AAAA;AAAA;AAAA,GAItB,CAEA,SAASE,GAAsB,CAC7B,MAAMb,EAAYD,EAAqB,EACvC,GAAI,CAACC,EAAW,OAEhB,GAAI,CAACV,EAAe,OAAQ,CAC1BU,EAAU,UAAY,mCAEtB,MAAMc,EAAgB,SAAS,cAAc,uBAAuB,EAChEA,GAAeA,EAAc,OAAM,EAEvC,MACF,CAEA,MAAMH,EAAa,KAAK,IACtB,EACA,KAAK,KAAKrB,EAAe,OAASD,CAAc,CACpD,EAEME,EAAcoB,IAChBpB,EAAcoB,GAGhB,MAAMI,GAAcxB,EAAc,GAAKF,EACjC2B,EAAWD,EAAa1B,EAGxB4B,EAFe3B,EAAe,MAAMyB,EAAYC,CAAQ,EAE7B,IAAId,CAAuB,EAAE,KAAK,EAAE,EAC/DgB,EAAmBR,EAAuBC,EAAYpB,CAAW,EAEvES,EAAU,UAAYiB,EAEtB,MAAMH,EAAgB,SAAS,cAAc,uBAAuB,EAChEA,GAAeA,EAAc,OAAM,EAEvCd,EAAU,mBAAmB,WAAYkB,CAAgB,CAC3D,CAIA,SAASC,GAAoC,CAC3C,MAAMC,EAAW5B,EAAwB,EAEnC6B,EAAO,KAAK,UAAU/B,CAAc,EACpCgC,EAAO,KAAK,UAAUF,CAAQ,EAEpC,GAAIC,IAASC,EAIb,IAFAhC,EAAiB8B,EAEb,CAAC9B,EAAe,OAClBC,EAAc,MACT,CACL,MAAMoB,EAAa,KAAK,IACtB,EACA,KAAK,KAAKrB,EAAe,OAASD,CAAc,CACtD,EACQE,EAAcoB,IAAYpB,EAAcoB,EAC9C,CAEAE,EAAmB,EACrB,CAIA,SAASU,EAAqBC,EAAO,CAEnC,GADsBA,EAAM,OAAO,QAAQ,+BAA+B,EACvD,CACjBL,EAAiC,EACjC,MACF,CAEA,MAAMM,EAAYD,EAAM,OAAO,QAAQ,sBAAsB,EAC7D,GAAIC,EAAW,CACb,MAAMC,EAAOD,EAAU,QAAQ,gBAAgB,EAC/C,GAAI,CAACC,EAAM,OAEX,MAAMC,EAAYD,EAAK,QAAQ,GAC/B,GAAI,CAACC,EAAW,OAEhB,MAAMC,EAAUtC,EAAe,KAAKuC,GAAQA,EAAK,MAAQF,CAAS,EAC5DG,EAAexC,EAAe,OAAOuC,GAAQA,EAAK,MAAQF,CAAS,EAEzE,GAAIG,EAAa,SAAWxC,EAAe,OACzC,OAMF,GAHAA,EAAiBwC,EACjBjC,EAAuBP,CAAc,EAEjC,CAACA,EAAe,OAClBC,EAAc,MACT,CACL,MAAMoB,EAAa,KAAK,IACtB,EACA,KAAK,KAAKrB,EAAe,OAASD,CAAc,CACxD,EACUE,EAAcoB,IAAYpB,EAAcoB,EAC9C,CAEAE,EAAmB,EAEnBjB,EAAS,QAAQ,CACf,MAAOgC,EAAUA,EAAQ,KAAO,UAChC,QAAS,kCACT,SAAU,WACV,SAAU,GAChB,CAAK,EAED,MACF,CAEA,MAAMG,EAAUP,EAAM,OAAO,QAAQ,qBAAqB,EAC1D,GAAIO,EAAS,CACX,MAAMC,EAASD,EAAQ,QAAQ,KACzBpB,EAAa,KAAK,IACtB,EACA,KAAK,KAAKrB,EAAe,OAASD,CAAc,CACtD,EAEQ2C,IAAW,QAAUzC,EAAc,EACrCA,GAAe,EACNyC,IAAW,QAAUzC,EAAcoB,IAC5CpB,GAAe,GAGjBsB,EAAmB,CACrB,CACF,CAIA,SAASoB,GAAoB,CAC3B,SAAS,iBAAiB,QAASV,CAAoB,EAEvDjC,EAAiBE,EAAwB,EACzCD,EAAc,EAEd2C,EAAmB,EAEnBrB,EAAmB,CACrB,CAEAoB,EAAiB"}